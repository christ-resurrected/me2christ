append head
  style: include scripture.css
-
  function expand(refs) {
    return refs.replaceAll('Mat.', 'Matthew ').replaceAll('Rom.', 'Romans ').replaceAll('Cor.', 'Corinthians ').replaceAll('Gal.', 'Galatians ').replaceAll('Eph.', 'Ephesians ').replaceAll('Php.', 'Philippians ').replaceAll('Col.', 'Colossians ').replaceAll('2-Thes.', '2-Thessalonians ').replaceAll('Tim.', 'Timothy ').replaceAll('Heb.', 'Hebrews ').replaceAll('Pet.', 'Peter ').replaceAll('Rev.', 'Revelation ')
  }

  function finalise(refs) {
    return refs.replaceAll(/-(\d+)/g, '&ndash;$1')
  }

// separate books by semicolon and chapters by comma e.g. [Matthew 5:27, 13:47,48; Luke 12:4-5]
mixin see(refs, label='See')
  - if (!refs) return
  - var books = expand(refs).split(';')
  span.see  (
  span= label
  each bookrefs in books
    -
      var chapters = bookrefs.trim().split(' ')
      var book = chapters[0]
      console.log()
      console.log(chapters)
      var out = ''
      for (var i = 1; i < chapters.length; i++) {
        var chapPassages = chapters[i].split(':')
        if (chapPassages.length != 2) continue;
        console.log(chapPassages)
        var passages = chapPassages[1].replace(/,$/, '').split(',')
        console.log(passages)
        for (const p of passages) {
          console.log(p)
          var verses = p.split('-')
          console.log(verses)
          if (verses.length == 1) verses.push(verses[0]);
          if (verses.length != 2) continue;
          console.log(verses[0])
          console.log(verses[1])
          if (verses[1] - verses[0] > 10) continue;
          for (var j = verses[0]; j <= verses[1]; j++) {
            // console.log(j)
            var ref = `${book} ${chapPassages[0]}:${j}`
            console.log(ref)
            out += VERSES[ref] + ' '
          }
          // console.log(out)
        }
        out += '<br/><br/>'
      }
      bookrefs = finalise(bookrefs)
    | 
    mark.tooltip!= bookrefs
      span.tooltiptext!= out
  span )

mixin seeAlso(refs)
  +see(refs, 'See also')

mixin verse(ref)
  .verse.tooltip-anchor
    span.pre= attributes.pre
    span.body
      block
    span  &ndash;
    - ref = finalise(expand(ref))
    mark!= ref
    +seeAlso(attributes.seeAlso)
